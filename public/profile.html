<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>CodeCrowds – Your Profile</title>
    <meta name="description" content="Your CodeCrowds profile." />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@300;400;600&display=swap"
      rel="stylesheet"
    >

    <!-- Global / external styles -->
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <div class="profile-wrapper">
      <header class="profile-header">
        <a href="/" class="profile-brand">
          <span class="profile-dot"></span>
          <span>CodeCrowds</span>
        </a>

        <div class="profile-user-pill">
          <div class="profile-avatar" id="profileAvatar">U</div>
          <span class="profile-email" id="profileEmail">you@example.com</span>
        </div>
      </header>

      <div class="profile-layout">
        <!-- SIDEBAR NAV -->
        <aside class="sidebar">
          <p class="sidebar-title">Dashboard</p>
          <ul class="nav-list">
            <li>
              <a href="index.html" class="nav-link">Home</a>
            </li>
            <li>
              <a href="profile.html" class="nav-link nav-link--active">Profile</a>
            </li>
            <li>
              <a href="services.html" class="nav-link">Services</a>
            </li>
            <li>
              <a href="messages.html" class="nav-link">Messages</a>
            </li>
            <li>
              <a href="settings.html" class="nav-link">Settings</a>
            </li>
            <li>
              <a href="index.html" class="nav-link nav-link--danger">Logout</a>
            </li>
          </ul>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="content-column">
          <!-- Profile card -->
          <section class="card">
            <h2>Your profile</h2>
            <p>Here’s how clients will see you on CodeCrowds.</p>

            <!-- VIEW MODE -->
            <div id="profileView">
              <div class="profile-row">
                <div class="profile-label">Display name</div>
                <div class="profile-value" id="profileName">New developer</div>
              </div>

              <div class="profile-row">
                <div class="profile-label">Email</div>
                <div class="profile-value" id="profileEmailMain">you@example.com</div>
              </div>

              <div class="profile-row">
                <div class="profile-label">Account type</div>
                <div class="profile-value">Free user</div>
              </div>

              <div class="btn-row">
                <button type="button" class="btn btn-primary" id="editProfileBtn">
                  Edit Profile
                </button>
                <a href="services.html" class="btn btn-secondary">
                  My Services
                </a>
              </div>
            </div>

            <!-- EDIT MODE -->
            <form id="profileEditForm" class="profile-edit is-hidden">
              <div class="profile-edit-row">
                <label for="editDisplayName" class="profile-edit-label">Display name</label>
                <input
                  type="text"
                  id="editDisplayName"
                  class="profile-edit-input"
                  placeholder="Your display name"
                  maxlength="64"
                />
              </div>

              <div class="profile-edit-row">
                <label for="editEmail" class="profile-edit-label">Email</label>
                <input
                  type="email"
                  id="editEmail"
                  class="profile-edit-input"
                  placeholder="you@example.com"
                  required
                />
              </div>

              <div class="profile-edit-actions">
                <button type="submit" class="btn btn-primary">Save changes</button>
                <button type="button" class="btn btn-muted" id="cancelEditBtn">
                  Cancel
                </button>
              </div>
            </form>
          </section>

          <!-- Services card -->
          <section class="card">
            <h2>Your services</h2>
            <p>Once you start posting, your services will appear here.</p>

            <div class="services-empty">
              You don’t have any services yet. Create one to start attracting clients.
            </div>

            <div class="btn-row">
              <button type="button" class="btn btn-primary">
                Create Service
              </button>
              <a href="services.html" class="btn btn-secondary">
                View My Services
              </a>
            </div>
          </section>
        </main>
      </div>

      <footer class="profile-footer">
        © 2025 CodeCrowds. All rights reserved.
      </footer>
    </div>

    <script>
      // ----- Load profile from localStorage / URL fallback -----
      const storedUsername = localStorage.getItem("username") || "";
      const storedEmail = localStorage.getItem("email") || "";

      const params = new URLSearchParams(window.location.search);
      const paramUsername = params.get("username") || "";
      const paramEmail = params.get("email") || "";

      const username = storedUsername || paramUsername || "";
      const email = storedEmail || paramEmail || "";

      const avatarEl = document.getElementById("profileAvatar");
      const emailBadge = document.getElementById("profileEmail");
      const emailMain = document.getElementById("profileEmailMain");
      const nameEl = document.getElementById("profileName");

      if (email) {
        emailBadge.textContent = email;
        emailMain.textContent = email;
      }

      let displayName = username;
      if (!displayName && email) {
        displayName = email.split("@")[0];
      }
      if (displayName) {
        nameEl.textContent = displayName;
      }

      const initialSource = displayName || email || "U";
      avatarEl.textContent = initialSource.trim()[0].toUpperCase();

      // ----- Edit Profile logic -----
      const profileView = document.getElementById("profileView");
      const profileEditForm = document.getElementById("profileEditForm");
      const editBtn = document.getElementById("editProfileBtn");
      const cancelEditBtn = document.getElementById("cancelEditBtn");
      const editDisplayNameInput = document.getElementById("editDisplayName");
      const editEmailInput = document.getElementById("editEmail");

      function enterEditMode() {
        // Prefill inputs with current values
        editDisplayNameInput.value = nameEl.textContent.trim();
        editEmailInput.value = emailMain.textContent.trim();

        profileView.classList.add("is-hidden");
        profileEditForm.classList.remove("is-hidden");
      }

      function exitEditMode() {
        profileEditForm.classList.add("is-hidden");
        profileView.classList.remove("is-hidden");
      }

      if (editBtn) {
        editBtn.addEventListener("click", enterEditMode);
      }

      if (cancelEditBtn) {
        cancelEditBtn.addEventListener("click", function () {
          exitEditMode();
        });
      }

      if (profileEditForm) {
        profileEditForm.addEventListener("submit", function (e) {
          e.preventDefault();

          const newName = editDisplayNameInput.value.trim();
          const newEmail = editEmailInput.value.trim();

          if (!newEmail) {
            alert("Email is required.");
            editEmailInput.focus();
            return;
          }

          // Update UI
          nameEl.textContent = newName || "New developer";
          emailBadge.textContent = newEmail;
          emailMain.textContent = newEmail;

          // Update avatar initial
          const source = (newName || newEmail || "U").trim();
          avatarEl.textContent = source[0].toUpperCase();

          // Persist to localStorage
          try {
            localStorage.setItem("email", newEmail);
            const usernameToStore = newName || newEmail.split("@")[0];
            localStorage.setItem("username", usernameToStore);
          } catch (err) {
            console.warn("Could not save updated profile to localStorage", err);
          }

          exitEditMode();
        });
      }
    </script>
  </body>
</html>
