<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Services - CodeCrowds</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="fullscreen-center">
    <div class="container">
        <h1>Available Services</h1>
        <div id="services-list"></div>

        <h2>Add a New Service</h2>
        <form id="serviceForm">
            <input type="text" id="service-title" placeholder="Service Title" required>
            <textarea id="service-description" placeholder="Service Description" required></textarea>
            <input type="number" id="service-price" placeholder="Price" required>
            <button type="submit">Add Service</button>
        </form>
        <p id="service-message" class="message"></p>

        <button id="backProfileBtn" class="btn">Back to Profile</button>
    </div>
</div>

<script>
const API_URL = 'https://codecrowds.onrender.com';
const token = localStorage.getItem('token');
const userId = localStorage.getItem('userId');
const servicesList = document.getElementById('services-list');
const serviceForm = document.getElementById('serviceForm');
const serviceMessage = document.getElementById('service-message');

// Redirect if not logged in
if (!userId || !token) {
    alert('You must be logged in to view this page.');
    window.location.href = 'login.html';
}

// Load all services
async function loadServices() {
    try {
        const res = await fetch(`${API_URL}/services`, {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        const services = await res.json();
        servicesList.innerHTML = '';
        services.forEach(s => {
            const div = document.createElement('div');
            div.className = 'service-card';
            div.innerHTML = `
                <h3>${s.title}</h3>
                <p>${s.description}</p>
                <p><strong>Price:</strong> $${s.price}</p>
                <p><strong>By User ID:</strong> ${s.userId}</p>
            `;
            servicesList.appendChild(div);
        });
    } catch (err) {
        servicesList.innerHTML = '<p class="error">Failed to load services</p>';
        console.error(err);
    }
}
loadServices();

// Add a new service
serviceForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const title = document.getElementById('service-title').value.trim();
    const description = document.getElementById('service-description').value.trim();
    const price = parseFloat(document.getElementById('service-price').value);

    if (!title || !description || !price) return;

    try {
        const res = await fetch(`${API_URL}/services`, {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ title, description, price, userId })
        });
        const data = await res.json();
        if (res.ok) {
            serviceMessage.textContent = 'Service added successfully!';
            serviceMessage.className = 'message success';
            serviceForm.reset();
            loadServices(); // Reload services
        } else {
            serviceMessage.textContent = data.error || 'Failed to add service';
            serviceMessage.className = 'message error';
        }
    } catch (err) {
        serviceMessage.textContent = 'Network error: ' + err.message;
        serviceMessage.className = 'message error';
        console.error(err);
    }
});

// Back to profile button
document.getElementById('backProfileBtn').addEventListener('click', () => {
    window.location.href = 'profile.html';
});
</script>
</body>
</html>
