<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>CodeCrowds - Showcase & Sell Your Skills</title>
    <meta name="description" content="Code Crowds — show and sell your coding skills, connect with developers, and grow your network." />

    <!-- Load fonts/styles -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- Use absolute path so the stylesheet resolves from any route -->
    <link rel="stylesheet" href="/style.css" />
  </head>

  <body>
    <!-- Skip link for keyboard users -->
    <a class="visually-hidden" href="#main">Skip to content</a>

    <div class="container container--transparent fade-in">
      <header class="site-header" role="banner">
        <div class="header-inner">
          <!-- Single heading + link for the site brand (text-only wordmark) -->
          <h1 class="brand-heading">
            <a href="/" class="site-logo" aria-label="Code Crowds home">
              <span class="brand-wordmark">
                <span class="brand-code">Code</span>
                <span class="brand-crowds">Crowds</span>
              </span>
            </a>
          </h1>
        </div>
      </header>

      <main id="main">
        <section class="features" aria-label="Highlights">
          <article class="feature-card card">
            <h3>Offer Your Services</h3>
            <p>Create posts to sell your coding skills and get noticed by clients worldwide.</p>
          </article>

          <article class="feature-card card">
            <h3>Connect & Collaborate</h3>
            <p>Rate and interact with other developers, build credibility, and grow your network.</p>
          </article>

          <article class="feature-card card">
            <h3>Ad-Free & Premium</h3>
            <p>Upgrade to premium for extra features like ad-free experience, lower fees, and more visibility.</p>
          </article>
        </section>

        <aside class="login-container card" aria-labelledby="login-heading">
          <h2 id="login-heading">Login</h2>

          <!-- method/action are set so non-JS fallback uses POST to the correct server route -->
          <form id="loginForm" method="post" action="/api/users/login" novalidate>
            <label for="loginEmail" class="visually-hidden">Email</label>
            <input id="loginEmail" name="email" type="email" class="input" placeholder="Email" autocomplete="username" required />

            <label for="loginPassword" class="visually-hidden">Password</label>
            <input id="loginPassword" name="password" type="password" class="input" placeholder="Password" autocomplete="current-password" required />

            <button type="submit" class="btn btn--primary">Login</button>
          </form>

          <p id="loginMessage" class="message" role="status" aria-live="polite"></p>
          <p class="signup-switch">Don't have an account? <a href="register.html">Sign up here</a></p>
        </aside>
      </main>

      <footer class="site-footer" role="contentinfo">
        &copy; <span id="year"></span> Code Crowds. All rights reserved.
      </footer>
    </div>

    <!-- Client JS: safely POSTs to /api/users/login and prevents credentials ending up in the URL -->
    <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('loginForm');
      const msg = document.getElementById('loginMessage');

      if (!form) return;

      form.addEventListener('submit', async (e) => {
        e.preventDefault(); // prevent default (no GET in URL)

        msg.textContent = ''; // clear prior messages

        const email = (form.email && form.email.value || '').trim();
        const password = (form.password && form.password.value) || '';

        if (!email || !password) {
          msg.textContent = 'Please enter both email and password.';
          return;
        }

        // show a simple "working" state (optional)
        const submitBtn = form.querySelector('button[type="submit"]');
        const prevText = submitBtn ? submitBtn.textContent : '';
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.textContent = 'Signing in...';
        }

        try {
          // POST JSON to the server route the app mounts at: /api/users/login
          const res = await fetch('/api/users/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password }),
            credentials: 'same-origin' // same-origin; server returns token JSON
          });

          const payload = await res.json().catch(() => null);

          if (!res.ok) {
            // server returns { success: false, error: { message } }
            const errorMsg = payload && payload.error && payload.error.message
              ? payload.error.message
              : `Login failed (${res.status})`;
            msg.textContent = errorMsg;
            return;
          }

          // success: server responds with { token, user }
          if (payload && payload.token) {
            // Save token locally for subsequent API calls (the server uses JWT)
            localStorage.setItem('codecrowds_token', payload.token);
          }

          // Redirect to profile or reload to show auth state
          window.location.href = '/profile.html';
        } catch (err) {
          console.error('Login failed', err);
          msg.textContent = 'Network error — please try again.';
        } finally {
          if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.textContent = prevText;
          }
        }
      });
    });

    // small year filler
    try { document.getElementById('year').textContent = new Date().getFullYear(); } catch (e) {}
    </script>
  </body>
</html>
